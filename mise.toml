[tools]
python = "3.14"

[tasks.build]
description = "Build docker compose images"
run = "docker compose build"

[tasks.test]
description = "Run the test suite inside Docker"
depends = ['build']
run = "docker compose run --rm test uv run python sandbox/manage.py test --noinput -v 2 --buffer tests"

[tasks.mypy]
description = "Run mypy type checking inside Docker"
depends = ['build']
run = "docker compose run --rm test uv run mypy django_periodic_tasks/ sandbox/"

[tasks.tox]
description = "Run the full tox test matrix inside Docker"
depends = ['build']
run = "docker compose run --rm test uv run tox"

[tasks.coverage]
description = "Run tests with coverage inside Docker"
depends = ['build']
run = [
    "docker compose run --rm test uv run coverage run sandbox/manage.py test --noinput -v 2 --buffer tests",
    "docker compose run --rm test uv run coverage report -i -m",
]

[tasks.docs-serve]
description = "Serve docs locally with live reload"
env = { DJANGO_SETTINGS_MODULE = "sandbox.settings_docgen" }
run = "uv run mkdocs serve --strict"

[tasks.docs-build]
description = "Build documentation"
env = { DJANGO_SETTINGS_MODULE = "sandbox.settings_docgen" }
run = "uv run mkdocs build --strict"

[tasks.docs]
description = "Build documentation for deployment"
depends = ['docs-build']
run = "rm -rf public/ && mkdir -p public/ && cp -r build/mkdocs/* public/"
